<style>
    .queue-status-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .status-header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 2rem;
        background: linear-gradient(135deg, #2c3e50, #3498db);
        color: white;
        border-radius: 15px;
    }
    
    .status-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        font-family: 'Poppins', sans-serif;
    }
    
    .clinic-info {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1rem;
        flex-wrap: wrap;
    }
    
    .info-badge {
        background: rgba(255,255,255,0.2);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .queue-sections {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }
    
    .queue-section {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    }
    
    .section-title {
        color: #2c3e50;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #3498db;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .patient-list {
        list-style: none;
    }
    
    .patient-item {
        padding: 1rem;
        margin-bottom: 0.75rem;
        border-radius: 8px;
        background: #f8f9fa;
        border-left: 4px solid #3498db;
        transition: transform 0.2s;
    }
    
    .patient-item:hover {
        transform: translateX(5px);
        background: #e9ecef;
    }
    
    .patient-item.active {
        border-left-color: #2ecc71;
        background: #e8f6f3;
    }
    
    .patient-ticket {
        font-weight: 700;
        color: #2c3e50;
        font-size: 1.1rem;
    }
    
    .patient-wait {
        color: #7f8c8d;
        font-size: 0.9rem;
        margin-top: 0.25rem;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin: 2rem 0;
    }
    
    .stat-box {
        background: white;
        padding: 1.5rem;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .stat-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .stat-box.waiting .stat-icon { color: #f39c12; }
    .stat-box.active .stat-icon { color: #3498db; }
    .stat-box.served .stat-icon { color: #2ecc71; }
    .stat-box.avg .stat-icon { color: #9b59b6; }
    
    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        margin: 0.5rem 0;
    }
    
    .stat-label {
        color: #7f8c8d;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .refresh-section {
        text-align: center;
        margin: 2rem 0;
        padding: 1.5rem;
        background: #e8f4fc;
        border-radius: 10px;
    }
    
    .counter-display {
        font-size: 3rem;
        font-weight: 800;
        color: #2c3e50;
        margin: 1rem 0;
        font-family: monospace;
    }
    
    .counter-label {
        color: #3498db;
        font-weight: 600;
        margin-bottom: 0.5rem;
    }
    
    @media (max-width: 768px) {
        .status-header h1 {
            font-size: 1.8rem;
        }
        
        .clinic-info {
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .queue-sections {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="queue-status-container">
    <div class="status-header">
        <h1><i class="fas fa-list-ol"></i> Live Queue Status</h1>
        <p>Real-time updates of all patients in queue</p>
        
        <div class="clinic-info">
            <div class="info-badge">
                <i class="fas fa-hospital"></i>
                <span><%= clinicName %></span>
            </div>
            <div class="info-badge">
                <i class="fas fa-clock"></i>
                <span>Open: <%= operatingHours %></span>
            </div>
            <div class="info-badge">
                <i class="fas fa-users"></i>
                <span><%= queueStats.waiting_count + queueStats.active_count %> in queue</span>
            </div>
        </div>
    </div>
    
    <div class="stats-grid">
        <div class="stat-box waiting">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-value"><%= queueStats.waiting_count %></div>
            <div class="stat-label">Waiting</div>
        </div>
        
        <div class="stat-box active">
            <div class="stat-icon">
                <i class="fas fa-user-md"></i>
            </div>
            <div class="stat-value"><%= queueStats.active_count %></div>
            <div class="stat-label">Being Served</div>
        </div>
        
        <div class="stat-box served">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-value"><%= queueStats.served_count %></div>
            <div class="stat-label">Served Today</div>
        </div>
        
        <div class="stat-box avg">
            <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-value"><%= queueStats.avg_estimated_wait || 15 %></div>
            <div class="stat-label">Avg Wait (min)</div>
        </div>
    </div>
    
    <div class="queue-sections">
        <div class="queue-section">
            <h2 class="section-title">
                <i class="fas fa-user-md" style="color: #2ecc71;"></i>
                Currently Being Served
            </h2>
            
            <% if (activePatients.length > 0) { %>
                <ul class="patient-list">
                    <% activePatients.forEach(patient => { %>
                        <li class="patient-item active">
                            <div class="patient-ticket">
                                <i class="fas fa-user-md"></i>
                                <%= patient.ticket_number %>
                            </div>
                            <div class="patient-wait">
                                <% if (patient.staff_name) { %>
                                    With: <%= patient.staff_name %>
                                <% } %>
                                • Service time: <%= patient.service_time || 0 %> min
                            </div>
                        </li>
                    <% }) %>
                </ul>
            <% } else { %>
                <div style="text-align: center; padding: 2rem; color: #95a5a6;">
                    <i class="fas fa-user-md" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <p>No patients currently being served</p>
                </div>
            <% } %>
        </div>
        
        <div class="queue-section">
            <h2 class="section-title">
                <i class="fas fa-clock" style="color: #f39c12;"></i>
                Waiting Patients
            </h2>
            
            <% if (waitingPatients.length > 0) { %>
                <ul class="patient-list">
                    <% waitingPatients.forEach((patient, index) => { %>
                        <li class="patient-item">
                            <div class="patient-ticket">
                                #<%= index + 1 %> - <%= patient.ticket_number %>
                            </div>
                            <div class="patient-wait">
                                Waiting: <%= patient.wait_time || 0 %> min • 
                                Est: <%= patient.estimated_wait || 15 %> min
                            </div>
                        </li>
                    <% }) %>
                </ul>
            <% } else { %>
                <div style="text-align: center; padding: 2rem; color: #95a5a6;">
                    <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <p>No patients waiting in queue</p>
                    <p style="font-size: 0.9rem; margin-top: 0.5rem;">
                        Join queue now for immediate service
                    </p>
                </div>
            <% } %>
        </div>
    </div>
    
    <div class="refresh-section">
        <div class="counter-label">Next Ticket Number</div>
        <div class="counter-display" id="nextTicket">CLINIC-110</div>
        <p style="color: #7f8c8d; margin-bottom: 1rem;">
            Last updated: <span id="lastUpdated"><%= new Date().toLocaleTimeString() %></span>
        </p>
        
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <button onclick="refreshQueue()" class="btn">
                <i class="fas fa-sync"></i> Refresh Queue
            </button>
            <a href="/join-queue" class="btn btn-primary">
                <i class="fas fa-ticket-alt"></i> Join Queue Now
            </a>
            <button onclick="startAutoRefresh()" class="btn" id="autoRefreshBtn">
                <i class="fas fa-play-circle"></i> Auto Refresh (30s)
            </button>
        </div>
    </div>
    
    <div style="background: white; border-radius: 12px; padding: 1.5rem; margin-top: 2rem;">
        <h2 style="color: #2c3e50; margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-info-circle"></i> Queue Information
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <div style="font-weight: 600; color: #2c3e50; margin-bottom: 0.5rem;">
                    <i class="fas fa-hourglass-half"></i> Estimated Wait Times
                </div>
                <div style="color: #555;">
                    Based on current queue length and average service time of 15 minutes
                </div>
            </div>
            
            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <div style="font-weight: 600; color: #2c3e50; margin-bottom: 0.5rem;">
                    <i class="fas fa-bell"></i> Notifications
                </div>
                <div style="color: #555;">
                    Patients receive SMS alerts when 2-3 patients away from their turn
                </div>
            </div>
            
            <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                <div style="font-weight: 600; color: #2c3e50; margin-bottom: 0.5rem;">
                    <i class="fas fa-mobile-alt"></i> Remote Monitoring
                </div>
                <div style="color: #555;">
                    Check your position from anywhere using your ticket number
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let autoRefreshInterval = null;
    let autoRefreshActive = false;
    
    function refreshQueue() {
        location.reload();
    }
    
    function startAutoRefresh() {
        const button = document.getElementById('autoRefreshBtn');
        
        if (!autoRefreshActive) {
            autoRefreshActive = true;
            button.innerHTML = '<i class="fas fa-pause-circle"></i> Stop Auto Refresh';
            button.classList.add('btn-warning');
            
            autoRefreshInterval = setInterval(() => {
                document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
                // In a real app, you would fetch updated data via AJAX
            }, 30000);
        } else {
            autoRefreshActive = false;
            button.innerHTML = '<i class="fas fa-play-circle"></i> Auto Refresh (30s)';
            button.classList.remove('btn-warning');
            clearInterval(autoRefreshInterval);
        }
    }
    
    // Simulate live updates for demo
    function simulateQueueMovement() {
        const nextTicketElem = document.getElementById('nextTicket');
        const currentNum = parseInt(nextTicketElem.textContent.split('-')[1]);
        nextTicketElem.textContent = `CLINIC-${currentNum + 1}`;
        
        // Update last updated time
        document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
    }
    
    // Simulate queue updates every 2 minutes for demo
    setInterval(simulateQueueMovement, 120000);
    
    // Initial call
    window.addEventListener('DOMContentLoaded', () => {
        // Fetch next ticket number from API
        fetch('/api/queue/stats')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update stats if needed
                }
            });
    });
</script>